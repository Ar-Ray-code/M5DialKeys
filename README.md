# M5DialKeys
M5Dial を USB HID キーボード化し、回転・タッチ・ボタン操作をパソコンへ送出するデバイスです。

<img width="581" height="408" alt="image" src="https://github.com/user-attachments/assets/3128d8ad-4089-499c-bee4-841ad4b35b01" />

## 概要
- PlatformIO 環境でビルドして M5Dial へ書き込むと、USB キーボードとして動作します。
- 画面左半分が `ESC`、右半分が一時的な `Shift Lock` として利用できます。
- ダイヤルの回転や中央ボタンで矢印キーや Enter/Delete を送信できます。

## 必要なもの
- M5Stack M5Dial 本体
- USB-C ケーブル
- PlatformIO (VS Code 拡張 or CLI)

## ビルドと書き込み
1. リポジトリをクローンし、PlatformIO 対応エディタで開きます。
2. M5Dial を USB で PC と接続します。
3. 下記コマンドでビルドと書き込みを行います。

```bash
pio run -t upload
```

初回は依存ライブラリがダウンロードされるため、ネットワーク接続が必要です。

## 使い方
### タッチパネル
- 画面左半分をタップ: `Esc` キーを送信します。
- 画面右半分をタップ: Shift Lock をトグルします。ON の間は画面に “Shift Lock” と表示され、次のキー送信後に自動的に解除されます。

### ダイヤル
- 時計回りに回す (1ノッチ=4カウント): `→` (Right Arrow) を送信します。
- 反時計回りに回す: `↓` (Down Arrow) を送信します。
- Shift Lock が有効な状態で回すと、それぞれ `D`/`A` として送信されます（送信後に Shift Lock は解除されます）。

### 中央ボタン
- 短押し (約3秒未満): `Enter` キーを送信します。Shift Lock が有効なら `Shift+Enter` になります。
- 長押し (約3秒以上): `Delete` キーを1回送り、長押ししている間は 0.5 秒ごとに `Delete` を繰り返し送信します。ボタンを離すと停止します。

## カスタマイズ
- `src/main.cpp` 冒頭の `#define KEY_LR_MODE` をコメントアウトすると、ダイヤル回転時の出力を `a`/`d` に切り替えられます。必要に応じて任意のキーに置き換えてください。
- `darken()` やカラーマクロを変更すれば、タッチエリアの配色を調整できます。

## トラブルシューティング
- PC に USB キーボードとして認識されない場合は、USB ケーブルのデータ線対応を確認し、M5Dial を再起動してください。
- 連続でキーが送信されない場合は、ダイヤルの物理ノッチ数と送信間隔が一致しているか確認し、必要に応じて `steps` 計算部分を調整してください。
